\# Catalog Microservice



Микросервис, отвечающий за логическую структуру файловой системы. Он управляет метаданными папок и файлов, строит иерархическое дерево и обеспечивает строгий контроль доступа (\*\*ACL\*\*) на уровне каждого объекта.



Реализован на \*\*Python\*\* с использованием \*\*gRPC\*\* для коммуникации и \*\*MongoDB\*\* для хранения данных.



\## Ключевой функционал



\* \*\*Управление метаданными:\*\* Создание, переименование, перемещение и удаление папок и записей о файлах.

\* \*\*Иерархическая структура:\*\* Хранение вложенности через ссылки `parent\_id`.

\* \*\*Access Control List (ACL):\*\* Гранулярная система прав доступа для пользователей и групп.

\* \*\*Валидация целостности:\*\* Запрет на удаление непустых папок, проверка существования родительских директорий.



\## Технологический стек



\* \*\*Язык:\*\* Python 3.14

\* \*\*API:\*\* gRPC (Protobuf)

\* \*\*Database:\*\* MongoDB (Driver: PyMongo)

\* \*\*Testing:\*\* Unittest

\* \*\*Containerization:\*\* Docker



\## Логика прав доступа (ACL)



Сервис реализует собственную логику проверки прав (`Security Layer`), встроенную в каждый RPC-вызов.



| Роль | Права | Описание |

| :--- | :--- | :--- |

| \*\*Owner\*\* (Владелец) | Full Access | Полный доступ: чтение, запись, удаление, изменение прав. |

| \*\*Writer\*\* (Редактор) | Read + Write | Может переименовывать, добавлять файлы, приглашать читателей. \*\*Не может удалять.\*\* |

| \*\*Reader\*\* (Читатель) | Read Only | Только просмотр содержимого директории. |

| \*\*Guest\*\* (Аноним) | Read Public | Доступ только к объектам с флагом `is\_public=True`. |



\## Структура модуля



\* `server.py` — Точка входа. Содержит:

&nbsp;   \* \*\*gRPC Server:\*\* Обработка сетевых запросов.

&nbsp;   \* \*\*AuthInterceptor:\*\* Middleware для извлечения токена и валидации сессии.

&nbsp;   \* \*\*Service Layer:\*\* Бизнес-логика (CRUD операции).

&nbsp;   \* \*\*ACL Methods:\*\* Приватные методы `\_can\_read` и `\_can\_write`.

\* `catalog.proto` — Contract-first описание API.

\* `test\_catalog\_full.py` — Комплексный набор тестов (функциональные + нагрузочные).

\* `Dockerfile` — Инструкции для сборки образа.



\## Описание API (gRPC)



Сервис реализует интерфейс `CatalogService`:



\* `CreateDirectory` — Создает новую папку (с проверкой прав родителя).

\* `RegisterFile` — Регистрирует файл (метаданные) в указанной папке.

\* `GetDirectoryContent` — Возвращает список папок и файлов (с фильтрацией по правам доступа).

\* `UpdateDirectory` — Переименование, перемещение или изменение списков доступа (`allowed\_readers`, `allowed\_writers`).

\* `DeleteDirectory` — Удаление папки (только если она пуста).

\* `DeleteFile` — Удаление метаданных файла.



\## Запуск и разработка



Для запуска требуется подключение к MongoDB.



\### 1. Сборка контейнера

```bash

docker build -t catalog-service .

